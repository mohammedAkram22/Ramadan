<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مواقيت الصلاة</title>
    <link rel="icon" href="">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header>
        <nav
            class="fixed w-full z-20 top-0 left-0 h-22.5 flex flex-wrap items-center duration-500 bg-transparent dark:backdrop-blur-xs">
            <div
                class="flex flex-wrap items-center justify-between px-4 pb-4 w-full mx-auto xl:max-w-300 min-[1200px]:max-w-285 min-[992px]:max-w-240 min-[768px]:max-w-180 min-[576px]:max-w-135">
                <div class="logo">
                    <a href="index.html" class="flex items-center space-x-3 rtl:space-x-reverse">
                        <img src="images/logo.png" alt="logo" class="max-w-22.5 max-h-22.5">
                    </a>
                </div>
                <div class="flex justify-center items-center">
                    <button data-collapse-toggle="navbar-default" type="button" id="toggler-btn"
                        class="inline-flex items-center p-2 w-10 h-10 justify-center text-body rounded-base md:hidden hover:text-heading focus:outline-none rounded-xl cursor-pointer text-md backdrop-blur-2xl hover:bg-amber-100 duration-200 bg-amber-50 text-black"
                        aria-controls="navbar-default" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="hidden w-full md:block md:w-auto  max-[768px]:absolute max-[768px]:top-full max-[768px]:left-0 max-[768px]:shadow-sm max-[768px]:shadow-gray-200 rounded-2xl md:min-w-125"
                        id="navbar-default">
                        <ul
                            class="font-medium flex flex-col justify-center items-center gap-5 p-4 md:p-0 rounded-2xl bg-transparent max-[768px]:bg-white md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0">
                            <li
                                class="backdrop-blur-2xl bg-amber-50 rounded-lg py-1 px-5 hover:bg-amber-100 duration-500 w-full cursor-pointer mx-0 text-center text-gray-800 [&.active]:bg-amber-100 active">
                                <a href="index.html"
                                    class="nav-link block py-2 px-3 w-full text-heading md:hover:bg-transparent md:border-0 md:hover:text-fg-brand md:p-0">مواقيت
                                    الصلاة</a>
                            </li>
                            <li
                                class="backdrop-blur-2xl bg-amber-50 rounded-lg py-1 px-5 hover:bg-amber-100 duration-500 w-full cursor-pointer mx-0 text-center text-gray-800 [&.active]:bg-amber-100">
                                <a href="wasfat.html"
                                    class="nav-link block py-2 px-3 w-full text-heading md:hover:bg-transparent md:border-0 md:hover:text-fg-brand md:p-0">وصفاتك</a>
                            </li>
                            <li
                                class="backdrop-blur-2xl bg-amber-50 rounded-lg py-1 px-5 hover:bg-amber-100 duration-500 w-full cursor-pointer mx-0 text-center text-gray-800 [&.active]:bg-amber-100">
                                <a href="quotes.html"
                                    class="nav-link block py-2 px-3 w-full text-heading md:hover:bg-transparent md:border-0 md:hover:text-fg-brand md:p-0">إقتباساتك</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <button class="cursor-pointer max-[768px]:ms-5 hover:bg-amber-100 duration-100 backdrop-blur-2xl bg-amber-50 p-2 flex items-center justify-center rounded-full w-10
                    h-10" id="mood-btn">
                    <i class="fa-regular fa-moon text-[18px]"></i></button>
            </div>
        </nav>
    </header>
    <main>
        <section
            class="hero relative w-full min-h-screen bg-[url(../images/hero-bg.jpg)] bg-no-repeat bg-cover sm:bg-bottom bg-left duration-900 before:content-[''] before:absolute before:top-0 before:right-0 before:bottom-0 before:left-0 before:z-0 dark:before:bg-[rgb(0,0,0,0.3)]">
            <div class="mx-auto md:max-w-[80%] pt-40 md:px-10 px-5 relative z-10">
                <div class="heading">
                    <h2 class="text-[30px]">مرحبا <span class="text-sky-600 name">❤</span></h2>
                </div>
                <div class="content">
                    <h4 class="sm:text-[25px] text-[18px] my-5">مواقيت الصلاة لهذا اليوم في مدينة <span
                            class="city text-sky-600"></span></h4>
                    <div
                        class="w-full h-25 bg-transparent backdrop-blur-2xl mt-10 rounded-lg prayers-container p-2 text-center">
                        <table cellpadding="10" class="w-full h-full relative" style="text-align: center;">
                            <thead>
                                <tr class="">
                                    <th class="sm:text-[23px] text-[18px]">الفجر</th>
                                    <th class="sm:text-[23px] text-[18px]">الظهر</th>
                                    <th class="sm:text-[23px] text-[18px]">العصر</th>
                                    <th class="sm:text-[23px] text-[18px]">المغرب</th>
                                    <th class="sm:text-[23px] text-[18px]">العشاء</th>
                                </tr>
                            </thead>
                            <tbody class="prayers-table"></tbody>
                        </table>
                    </div>
                    <h4 class="sm:text-[30px] mt-5 text-center text-[20px]">الوقت المتبقي لصلاة <span
                            class="text-sky-600">المغرب</span>
                    </h4>
                    <div class="timer text-center mt-5 text-[50px]"></div>
                </div>
            </div>
        </section>

        <section class="start duration-500">
            <div
                class="fixed top-0 right-0 left-0 bottom-0 w-full bg-[#1E3D4F] bg-[url(../images/bg-1.jpg)] min-[900px]:bg-cover bg-contain bg-center bg-no-repeat z-20 border-0">
                <div
                    class="flex items-end justify-start pb-50 md:max-w-[60%] sm:max-w-[90%] max-w-full mx-auto min-h-screen">
                    <div class="min-[900px]:w-125 w-100 max-[900px]:h-12.5 px-5 flex">
                        <input type="text" placeholder="أدخل اسمك"
                            class="bg-[#396a86] text-white w-full p-5 outline-0 rounded-[0_8px_8px_0] border-2 border-l-0 border-transparent focus:border-sky-700"
                            id="username">
                        <button
                            class="bg-sky-700 px-10 rounded-[8px_0_0_8px] cursor-pointer text-white font-black hover:bg-sky-600 duration-300"
                            id="done-btn">تم</button>
                        <button
                            class="underline px-5 cursor-pointer text-white font-black hover:text-sky-400 duration-300"
                            id="skip-btn">تخطي</button>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script>
        // timer

        // -----------------------------
        // 1) جلب المدينة والدولة من الموقع
        // -----------------------------
        navigator.geolocation.getCurrentPosition(
            async (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;

                const url = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=ar`;
                const res = await fetch(url);
                const data = await res.json();

                const city = data.city || data.locality;
                const country = data.countryName;

                document.querySelector(".content .city").textContent = city;

                // بعد ما نجيب المدينة والدولة → نبدأ البرنامج
                start(city, country);
            },
            () => {
                document.querySelector(".timer").textContent =
                    "الرجاء السماح للموقع";
            }
        );

        // -----------------------------
        // 2) جلب وقت المغرب من API
        // -----------------------------
        async function getMaghribTime(city, country) {
            const url = `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=2`;
            const res = await fetch(url);
            const json = await res.json();
            return json.data.timings.Maghrib;
        }

        // -----------------------------
        // 3) حساب الوقت المتبقي
        // -----------------------------
        function getRemainingTime(targetTime) {
            const now = new Date();
            const [h, m] = targetTime.split(":").map(Number);

            const target = new Date();
            target.setHours(h, m, 0, 0);

            // إذا المغرب مرّ → اليوم التالي
            if (target < now) target.setDate(target.getDate() + 1);

            let diff = target - now;

            const hours = Math.floor(diff / (1000 * 60 * 60));
            diff %= (1000 * 60 * 60);

            const minutes = Math.floor(diff / (1000 * 60));
            diff %= (1000 * 60);

            const seconds = Math.floor(diff / 1000);

            return { hours, minutes, seconds };
        }

        // -----------------------------
        // 4) تشغيل العداد
        // -----------------------------
        function toArabic(num) {
            const arabic = ["٠", "١", "٢", "٣", "٤", "٥", "٦", "٧", "٨", "٩"];
            return num
                .toString()
                .split("")
                .map(n => arabic[n] || n)
                .join("");
        }

        async function start(city, country) {
            const maghrib = await getMaghribTime(city, country);

            function update() {
                const t = getRemainingTime(maghrib);

                const item = `
        <ul class="flex items-center justify-center">
            <li class="text-[20px] sm:text-[40px]">
                <span class="text-[30px] sm:text-[60px] text-sky-600 max-[650px]:text-[35px]">${toArabic(t.hours)}</span> ساعة :
            </li>
            <li class="text-[20px] sm:text-[40px]">
                <span class="text-[30px] sm:text-[60px] text-sky-600 max-[650px]:text-[35px]">${toArabic(t.minutes)}</span> دقيقة :
            </li>
            <li class="text-[20px] sm:text-[40px]">
                <span class="text-[30px] sm:text-[60px] text-sky-600 max-[650px]:text-[35px]">${toArabic(t.seconds)}</span> ثانية
            </li>
        </ul>
    `;
                document.querySelector(".timer").innerHTML = item;
            }

            update();
            setInterval(update, 1000);
        }


        // -----------------------------
        // 1) جلب مواقيت الصلاة
        // -----------------------------
        async function getPrayerTimes(city, country) {
            const url = `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=2`;
            const res = await fetch(url);
            const data = await res.json();
            return data.data.timings;
        }

        // -----------------------------
        // 2) عرض المواقيت في الجدول
        // -----------------------------
        function displayPrayerTimes(times) {
            const table = document.querySelector(".prayers-table");

            const prayers = [
                { time: times.Fajr },
                { time: times.Dhuhr },
                { time: times.Asr },
                { time: times.Maghrib },
                { time: times.Isha }
            ];

            let html = "";
            prayers.forEach(p => {
                html += `<td class="text-[35px] text-sky-600 max-[650px]:text-[20px]">${toArabic(p.time)}</td>`;
            });

            table.innerHTML = html;
        }

        // -----------------------------
        // 3) دمج الموقع + مواقيت الصلاة
        // -----------------------------
        navigator.geolocation.getCurrentPosition(
            async (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;

                const url = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=ar`;
                const res = await fetch(url);
                const data = await res.json();

                const city = data.city || data.locality;
                const country = data.countryName;

                // عرض المدينة
                document.querySelector(".content .city").textContent = `${city}`;

                // جلب المواقيت بعد معرفة الموقع
                const times = await getPrayerTimes(city, country);
                displayPrayerTimes(times);
            },
            () => {
                document.querySelector(".prayers-table").innerHTML =
                    `<tr><td colspan="2">الرجاء السماح بأخذ الموقع</td></tr>`;
            }
        );

        // done btn
        const doneBtn = document.querySelector("#done-btn");
        const username = document.querySelector("#username");
        const name = document.querySelector(".hero .name");
        doneBtn.onclick = () => {
            name.textContent = `${username.value} ❤`
            startSec.classList.add("opacity-0", "invisible")
        }

        // skip btn
        const skipBtn = document.querySelector("#skip-btn");
        const startSec = document.querySelector(".start");
        skipBtn.onclick = () => startSec.classList.add("opacity-0", "invisible")
    </script>
    <script src="js/script.js"></script>
</body>

</html>